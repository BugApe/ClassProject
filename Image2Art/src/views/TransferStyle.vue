<!--
    Selfie2Anime <https://selfie2anime.com>
    Copyright (c) 2019 by SilentByte <https://www.silentbyte.com/>
-->

<!--suppress HtmlUnknownAnchorTarget, CheckEmptyScriptTag -->
<template>
    <div id="Home">
        <!-- Navigation -->
        <nav id="mainNav"
             class="navbar navbar-expand-lg navbar-light fixed-top py-3">
            <div class="container">
                <a href="#home" class="navbar-brand js-scroll-trigger">
                    <span class="navbar-brand-inverted">Selfie</span>2<span class="navbar-brand-inverted">Anime</span>
                    アニメ
                </a>
                <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
                        data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
                        aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ml-auto my-2 my-lg-0">
                        <li class="nav-item">
                            <a href="#home" class="nav-link js-scroll-trigger">
                                {{ $t("home") }}
                            </a>
                        </li>
                    
                        <li class="nav-item">
                            <a href="#about" class="nav-link js-scroll-trigger">
                                {{ $t("about") }}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#portfolio" class="nav-link js-scroll-trigger">
                                {{ $t("portfolio") }}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#contact" class="nav-link js-scroll-trigger">
                                {{ $t("contact") }}
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- Masthead -->
        <header class="masthead">
            <div class="container h-100">
                <div class="row h-100 align-items-center justify-content-center">
                    <div class="col-lg-10 align-self-center">
                        <PhotoUploader />
                    </div>
                </div>
            </div>
        </header>
        <!-- Footer -->
        <footer class="bg-light py-5">
            <div class="container">
                <div class="small text-center text-muted">
                  
                    <a href="/terms/" target="_blank">
                        Terms of Service
                    </a>
                    &bull;
                    <a href="/privacy/" target="_blank">
                        Privacy Statement
                    </a>
                </div>

                <hr />

                <div class="small text-center text-muted">
                    Copyright &copy; 2019 by
                    <a href="https://twitter.com/RicoBeti">Rico Beti</a>
                    &amp;
                    <a href="https://twitter.com/nathangloverAUS">Nathan Glover</a>
                </div>
            </div>
        </footer>
    </div>
</template>

<i18n>
    en:
        home: Home
     
        about: About
        portfolio: Portfolio
        contact: Contact

    zh:
        home: 首页

        about: 我们
        portfolio: 看看
        contact: 联系

</i18n>

<!--suppress JSMethodCanBeStatic, JSUnusedGlobalSymbols, TypeScriptCheckImport -->
<script lang="ts">
    import {
        Component,
        Vue,
    } from "vue-property-decorator";

    import axios from "axios";
    import * as creative from "@/vendor/creative";

  /*   import PhotoUploader from "@/components/PhotoUploader.vue";


    @Component({
        components: {
            PhotoUploader,
        },
    }) */
    export default class Home extends Vue {
        carouselImageCount = 22;
        counter = 0;
        estimateCounter = 0;
        counterTimestamp = 0;
        selfiesPerSecond = 0;
        counterIntervalHandle = 0;

        transparent1x1 = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";

        $th(key: string, values: any | undefined) {
            return this.$t(key, values)
                .toString()
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;")
                .replace(/\[@\s*/g, "<span class=\"text-primary font-weight-bold\">")
                .replace(/\s*@\]/g, "</span>");
        }

        onUpdateCounter() {
            this.estimateCounter = Math.ceil(
                this.counter
                + (Date.now() / 1000 - this.counterTimestamp)
                * this.selfiesPerSecond,
            );
        }

        async fetchStats() {
            // TODO: Replace current manually calculated estimates with actual real-time numbers once back-end is done.
            this.counter = 470444;
            this.selfiesPerSecond = 0.241254;
            this.counterTimestamp = 1567246919;
            this.estimateCounter = this.counter;

            if(this.counterIntervalHandle) {
                clearInterval(this.counterIntervalHandle);
            }

            this.onUpdateCounter();
            this.counterIntervalHandle = window.setInterval(this.onUpdateCounter, 4000);

            // try {
            //     const response = await axios.get(process.env.VUE_APP_API_COUNT_URL);
            //     this.counter = parseInt(response.data["count"]);
            //     this.selfiesPerSecond = parseFloat(response.data["sps"]);
            //     this.counterTimestamp = Date.now();
            //     this.estimateCounter = this.counter;
            //
            //     if(this.counterIntervalHandle) {
            //         clearInterval(this.counterIntervalHandle);
            //     }
            //
            //     this.onUpdateCounter();
            //     this.counterIntervalHandle = setInterval(this.onUpdateCounter, 4000);
            // } catch(e) {
            //     // tslint:disable-next-line
            //     console.log(e);
            // }
        }

        mounted() {
            this.fetchStats();
            creative.init(jQuery);

            if(navigator.language === "zh"
                || navigator.language === "zh-CN"
                || (navigator.languages && navigator.languages.includes("zh"))) {
                this.$root.$i18n.locale = "zh";
            }
        }

        beforeDestroy() {
            if(this.counterIntervalHandle) {
                clearInterval(this.counterIntervalHandle);
            }
        }
    }
</script>

<style lang="scss" scoped>
    $carousel-size: 100px;

    section h2, .large-caption {
        font-size: 2.8em;
        line-height: 1.25;

        @media (max-width: 576px) {
            font-size: 2.0em;
        }
    }

    .nav-item, .page-section h2 {
        text-transform: uppercase;
    }

    .nav-item .nav-link {
        font-size: 1.2rem !important;
    }

    #mainNav .navbar-brand {
        font-size: 1.7rem !important;
        color: rgba(255, 255, 255, 0.7);
    }

    #mainNav .navbar-brand-inverted {
        color: #f06292;
    }

    #mainNav {
        background: rgba(30, 30, 30, 0.8);
    }

    #mainNav.navbar-scrolled {
        background: #fff;

        .navbar-brand {
            color: #f06292;
        }

        .navbar-brand-inverted {
            color: #212529;
        }
    }

    #portfolio .container-fluid {
        max-width: 12 * 160px;
    }

    .portfolio-box-caption {
        -webkit-transition: opacity 0.75s ease !important;
        transition: opacity 0.75s ease !important;;
    }
</style>
